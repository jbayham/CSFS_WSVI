---
title: "Updating Reduced Match Criteria for the Forest Restoration & Wildfire Risk Mitigation Grant"
author: "Innocent Vomitadyo and Jude Bayham"
format: 
  html:
      toc: TRUE
      embed-resources: true
      page-layout: full
---

## Introduction

In 2020, our research team at Colorado State University developed the [Wildfire Social Vulnerability Index](https://jbayham.github.io/CSFS_WSVI/report.html) (WFSVI) in order to set a criteria for reduced match for the Forest Restoration & Wildfire Risk Mitigation (FRWRM) Grant. This report describes updates to the WFSVI including updated data from the US Census, alignment with the federal [Justice 40](https://screeningtool.geoplatform.gov/en/#3/33.47/-97.5) initiative, and further analysis of the WFSVI and reduced match criteria. 



## American Community Survey Update

The original WFSVI was built using 5-year (2016 - 2020) [American Community Survey](https://data.census.gov/) (ACS) estimates. We have updated the WFSVI using the most current 5-year (2017-2021) ACS data. In some cases, no data is reported for a census block group because of poor response to the ACS or insufficient sample size to meet data disclosure requirements.  We use two methods to impute missing values.  First, if the data is reported at the census tract^[Multiple block groups are [nested within tracts](https://www2.census.gov/geo/pdfs/reference/geodiagram.pdf).], we use the census tract data to fill any missing records. While these data may be less spatially accurate, they represent the next best estimate of the block group value.  Second, we use a machine learning imputation model to complete missing records when tract level information is unavailable. The machine learning method is known as random forest and is implemented via [missForest](https://github.com/stekhoven/missForest) package in R. The random forest method uses nonmissing data for one variable to train a model based on other nonmissing variables from other block groups around the state and uses that model to estimate missing values. It applies this procedure to each variable and iteratively updates until the model converges on its best estimate (see the [package documentation](https://github.com/stekhoven/missForest) for more information).  

The original WFSVI used ACS data but sourced the data from [Safegraph](https://www.safegraph.com/free-data/open-census-data). While the data was accurate, it was less accessible and relied on analysts at SafeGraph to update the data when the Census released new data. We have rebuilt the code to access the Census Application Programming Interface (API) via the [tidycensus](https://walker-data.com/tidycensus/) package. The [code](https://github.com/jbayham/CSFS_WSVI/blob/master/Build/Code/01_get_data.R) now downloads data for the Census Block Groups (CBG) and Census Tracts, then calculates the index component for both geographies using tract information to fill in missing block group information. The user can now define the year from which to query census data, making the layer easy to update in the future.


## Justice 40

[Executive Order 14008](https://www.federalregister.gov/documents/2021/02/01/2021-02177/tackling-the-climate-crisis-at-home-and-abroad#:~:text=Sec.%20223.%20Justice40,40-percent%20goal.) directed the Council on Environmental Quality (CEQ) to develop the Climate and Economic Justice Screening Tool (CEJST). This tool uses data to analyze burdens across eight categories: climate change, energy, health, housing, legacy pollution, transportation, water and wastewater, and workforce development. The primary purpose of the CEJST is to aid federal agencies in identifying disadvantaged communities that would benefit from the programs offered under the Justice40 Initiative. While the Colorado State Forest Service is not a federal agency, the goal of the CEJST is aligned with the intent of HB 20-1057, which established the reduced match criteria.

We collect data from the [Council on Environmental Quality](https://screeningtool.geoplatform.gov/en/downloads). The WFSVI is constructed at the Census Block Group (CBG), while the CEJST is constructed at the Census Tract (comprised of CBGs). The CEJST contains a binary indicator for every Census Tract that determines whether it is considered "disadvantaged." We consider any disadvantaged Census Tract to qualify for reduced match. 


## Analysis

Data from the ACS is sampled with uncertainty. We develop a method to investigate how the uncertainty affects the qualifying classification of a particular block group. A margin of error is reported for each variable (component of the WFSVI) in each block group. We use the margin of error to estimate the standard deviation of the reported estimate.  We define a normal sampling distribution with the estimate as the mean and its standard deviation for each census variable for each block group. We then conduct a Monte Carlo simulation by sampling values from each distribution and recomputing the WFSVI. We run 1000 simulations and calculate the fraction of simulations that a block group qualifies based on its WFSVI above the 75th percentile cutoff. For example, a block group may qualify for reduced match in every one of the 1000 simulations indicating strong confidence that that block group indeed should qualify. In contrast, a block group that only qualifies 50% of the time suggests less confidence that it should qualify. The simulation is conducted in the script [07_monte_carlo_simulation.R](https://github.com/jbayham/CSFS_WSVI/blob/master/Build/Code/07_monte_carlo_simulation.R).


## Updated WFSVI Layer

```{r}
#| echo: false
#| fig-height: 8


suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(sf,quietly = T))
suppressPackageStartupMessages(library(leaflet,quietly = T))
suppressPackageStartupMessages(library(scales,quietly = T))

#Read data
sim_results <- readRDS("../Build/Cache/final_simulated_results.rds") 

wfsvi_j40 <- readRDS('../Build/Output/wfsvi_j40.rds') %>%
  st_transform(4326) %>%
  mutate(q_indicator=ifelse(qualifying_cbg==1,"Qualifying","Not Qualifying"),
         across(c(poverty_percent_below_1_rank:wfsvi),~round(.,digits = 2))) %>%
  #inner_join(select(sim_results,GEOID,percent_qualify)) 
  inner_join(sim_results,by = "GEOID") 



#Set color scale
color_scale <- colorFactor(palette = "viridis",domain = c("Qualifying","Not Qualifying"))

#################
# Create the map
#map <- leaflet(data = slice_sample(wfsvi_j40,n=200)) %>%
map <- leaflet(data = wfsvi_j40) %>%
  addTiles() %>%
  setView(lng = -105.5509, lat = 39.5501, zoom = 7)  # Set initial map view to Colorado

# Add census block groups as polygons
map <- map %>%
  addPolygons(group = "qualifying",
              fillColor = ~color_scale(q_indicator), 
              fillOpacity = 0.4,
              color = "white", 
              weight = 1,
              popup = ~paste0("<b>Block Group ID:</b> ", GEOID,
                              "<br><b>WFSVI:</b> ", wfsvi,
                              "<br><b>Qualifying Frequency:</b> ", percent(percent_qualify,accuracy=1),
                              "<br><b>J40 Qualifying:</b> ", Identified.as.disadvantaged,
                              "<br><b>Poverty (12%):</b> ", poverty_percent_below_1_rank,
                              "<br><b>Unemployed (7%):</b> ", civ_labor_force_unemployed_percent_2_rank,
                              "<br><b>Household Income (12%):</b> ", directional_median_hh_income_3_rank,
                              "<br><b>Education (7%):</b> ", no_hs_degree_percent_4_rank,
                              "<br><b>Over 65 (2%):</b> ", over_65_percent_5_rank,
                              "<br><b>Under 18 (2%):</b> ", under_18_percent_6_rank,
                              "<br><b>Disability (2%):</b> ", disabled_adult_percent_7_rank,
                              "<br><b>Single-parent Family (2%):</b> ", single_householder_percent_8_rank,
                              "<br><b>Minority (12%):</b> ", percent_minority_9_rank,
                              "<br><b>English-speaking (5%):</b> ", eng_proficiency_rank,
                              "<br><b>Mobile Housing (5%):</b> ", mobile_units_rank,
                              "<br><b>No Vehicle (2%):</b> ", no_vehicle_percent_14_rank,
                              "<br><b>Income Inequality (12%):</b> ", Gini_income_rank,
                              "<br><b>Education Inequality (12%):</b> ", Gini_education_rank))

map <- map %>%
  addLegend("bottomright", pal = color_scale, values = c("Qualifying","Not Qualifying"),
            title = NULL) %>%
  addLayersControl(
    overlayGroups = c("qualifying"),
    options = layersControlOptions(collapsed = TRUE)
  )
map

```

The interactive map shows census block groups that qualify for reduced match in yellow. The user can zoom into any location and click on block groups for more information.  The popup contains the block group identifying number, the WFSVI value, the qualifying frequency described above, whether it qualifies because of its Justice 40 designation, and the value of each WFSVI component. The index is described in more detail in the [original report](report.html). The WFSVI and its components are all displayed in percentiles of the distribution of all values in Colorado block groups. The higher the value, the more likely the block group is to qualify for the reduced match. The percentage reported for each index component represents the weight of the component in the overall WFSVI. Note that the percentages are rounded and may not add to one




## Limitations

American Community Survey data is based on a sample with a reported margin of error. The COVID-19 pandemic impacted trends and affected the ability to collect data due to sampling challenges. The [U.S. Census Bureau reported](https://www.census.gov/newsroom/blogs/random-samplings/2021/10/pandemic-impact-on-2020-acs-1-year-data.html) that, due to the difficulties of fielding a household survey during the COVID-19 pandemic, household nonresponse increased substantially in the ACS, with evidence of increased nonresponse bias in many statistics. These challenges largely apply to the 1-year ACS estimates and are less of a concern for the 5-year estimates. However, these inaccuracies and high margins of errors may lead to inaccurate classifications. It may take some time before the full impact of the pandemic on census data accuracy is fully understood. It is also important to note that the margin of error may be significant in small census block groups. We acknowledge the potential that the data may be inaccurate. However, the ACS is the most reliable data to calculate the WFSVI. 


